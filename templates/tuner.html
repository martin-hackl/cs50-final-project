{% extends "layout.html" %}

{% block title %}
    Tuner
{% endblock %}

{% block main %}
    <h1>Tuner</h1>

    <p>For the moment you can playback every note and tune your guitar by ear. The "low D" is for Drop D tuning. Maybe I will try to implement a more advanced tuner later.</p>
    <p>The sounds I use are from <a href="https://freesound.org/people/Kyster/packs/7397/" target="_blank">Freesound.org</a></p>

    
    <button class="btn btn-primary" id="Dlow" type="button">low D</button>
    <button class="btn btn-primary" id="E" type="button">E</button>
    <button class="btn btn-primary" id="A" type="button">A</button>
    <button class="btn btn-primary" id="D" type="button">D</button>
    <button class="btn btn-primary" id="G" type="button">G</button>
    <button class="btn btn-primary" id="B" type="button">B</button>
    <button class="btn btn-primary" id="e" type="button">e</button>

    <script>
            window.addEventListener("DOMContentLoaded", loadPage, false);

            const urlE = "https://cdn.freesound.org/previews/117/117677_646701-lq.mp3"
            const urlA = "https://cdn.freesound.org/previews/117/117673_646701-lq.mp3"
            const urlD = "https://cdn.freesound.org/previews/117/117676_646701-lq.mp3"
            const urlG = "https://cdn.freesound.org/previews/117/117678_646701-lq.mp3"
            const urlB = "https://cdn.freesound.org/previews/117/117674_646701-lq.mp3"
            const urle = "https://cdn.freesound.org/previews/117/117679_646701-lq.mp3"
            const urlDlow = "https://cdn.freesound.org/previews/117/117675_646701-lq.mp3"
            
            let ctx = null;
            let audio;
            let timeout;

            function loadPage() {
                //console.log("loadPage")
                //createAudioContext("viper");
                ctx = new AudioContext();
                
                fetch(urlE)
                    .then(data => data.arrayBuffer())
                    .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
                    .then(decodedAudio => {
                        audio_E = decodedAudio;
                    });

                fetch(urlA)
                    .then(data => data.arrayBuffer())
                    .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
                    .then(decodedAudio => {
                        audio_A = decodedAudio;
                    });
                
                fetch(urlD)
                    .then(data => data.arrayBuffer())
                    .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
                    .then(decodedAudio => {
                        audio_D = decodedAudio;
                    });

                fetch(urlG)
                    .then(data => data.arrayBuffer())
                    .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
                    .then(decodedAudio => {
                        audio_G = decodedAudio;
                    });

                fetch(urlB)
                    .then(data => data.arrayBuffer())
                    .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
                    .then(decodedAudio => {
                        audio_B = decodedAudio;
                    });

                fetch(urle)
                    .then(data => data.arrayBuffer())
                    .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
                    .then(decodedAudio => {
                        audio_e = decodedAudio;
                    });

                fetch(urlDlow)
                    .then(data => data.arrayBuffer())
                    .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
                    .then(decodedAudio => {
                        audio_Dlow = decodedAudio;
                    });
            }       

            //playback buffered audiofile
            function playback(note) {
                const playSound = ctx.createBufferSource();
                playSound.buffer = note;
                playSound.connect(ctx.destination);
                playSound.start(ctx.currentTime);
            }

            //Eventlisteners for buttons calling createAudioContext() and then playback()

            document.getElementById("E").addEventListener("click", async () => {
                playback(audio_E);
            });

            document.getElementById("A").addEventListener("click", async () => {
                playback(audio_A);
            });

            document.getElementById("D").addEventListener("click", async () => {
                playback(audio_D);
            });

            document.getElementById("G").addEventListener("click", async () => {
                playback(audio_G);
            });

            document.getElementById("B").addEventListener("click", async () => {
                playback(audio_B);
            });

            document.getElementById("e").addEventListener("click", async () => {
                playback(audio_e);
            });

            document.getElementById("Dlow").addEventListener("click", async () => {
                playback(audio_Dlow);
            });

    </script>




{% endblock %}